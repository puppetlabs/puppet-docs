<!DOCTYPE html>
<html dir="ltr" lang="en-US">
  <head>
  	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  	<title>Documentation | Puppet Labs - Language Guide</title>
  	<meta name="description" content="The open source leader in data center automation">
  	<link rel="alternate" type="text/xml" title="Puppet Labs RSS 0.92 Feed" href="http://puppetlabs.com/feed/rss/">
  	<link rel="alternate" type="application/atom+xml" title="Puppet Labs Atom Feed" href="http://puppetlabs.com/feed/atom/">
  	<link rel="alternate" type="application/rss+xml" title="Puppet Labs RSS 2.0 Feed" href="http://puppetlabs.com/feed/">
  	<link rel="pingback" href="http://puppetlabs.com/xmlrpc.php">
    <link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://puppetlabs.com/xmlrpc.php?rsd" />
    <link rel='index' title='Puppet Labs' href='http://docs.puppetlabs.com' />

<!-- Google stats -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-1537572-5");
pageTracker._setDomainName(".puppetlabs.com");
pageTracker._trackPageview();
} catch(err) {}</script>
<!-- End Google stats -->


    <!-- FIXME: absolute paths -->

    <script type='text/javascript' src='/files/javascripts/html5.js'></script>
    <script type='text/javascript' src='/files/javascripts/jquery-1.3.2.min.js'></script>
    <script type='text/javascript' src='/files/javascripts/drop_down.js'></script>
    <script type='text/javascript' src='/files/javascripts/cufon-yui.js'></script>
    <script type='text/javascript' src='/files/fonts/Klavika_400-Klavika_600.font.js'></script>
    <script type='text/javascript' src='/files/javascripts/ampersands.js'></script>

    <!-- All in One SEO Pack 1.6.10.1 by Michael Torbert of Semper Fi Web Design[127,146] -->
    <meta name="keywords" content="Puppet, puppet labs, reductive labs, open source, system administrator, ruby, data center, automation, support" />
    <link rel="canonical" href="http://docs.puppetlabs.com" />
    <!-- /all in one seo pack -->
	
    <!-- FIXME: absolute paths -->

    <link rel="stylesheet" type="text/css" href="/files/stylesheets/style.css" media="screen"> 
    <link rel="stylesheet" type="text/css" href="/files/stylesheets/syntax.css" media="screen"> <!-- index -->

    <!--[if IE 7]>
	  <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_7.css" media="screen"> <!-- index -->
    <![endif]-->
  
    <!--[if IE 8]>
	    <link rel="stylesheet" type="text/css" href="/files/stylesheets/ie_8.css" media="screen"> <!-- index -->
    <![endif]-->		

  	<script type="text/javascript">
      Cufon.replace('h1, h2', { fontWeight: '600' });
  	</script>
</head>



        
  <body id="resources" class="docs">
  <style type="text/css">h1, h2{ visibility : hidden }</style>		
  <!--[if IE 8]>
    <style type="text/css">h1, h2{ visibility : visible }</style>
  <![endif]-->		

  	<header id="header">
      <div class="site-width">
    		<h1><a href="http://puppetlabs.com/"><span>Puppet Labs</span></a></h1>
        <a class="screen-reader-content" href="#content">Skip navigation</a>
        <nav>
    		<ul id="global-navigation">
          <li id="puppet-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/puppet/">
              <span>Puppet</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>            
              <li>
                <ul>
                  <li class="page_item page-item-757"><a href="http://www.puppetlabs.com/puppet/introduction/" title="Introduction">Introduction</a></li>
<li class="page_item page-item-769"><a href="http://www.puppetlabs.com/puppet/requirements/" title="Requirements">Requirements</a></li>
<li class="page_item page-item-956"><a href="http://www.puppetlabs.com/puppet/solutions/" title="Solutions">Solutions</a></li>
<li class="page_item page-item-1159"><a href="http://www.puppetlabs.com/puppet/users/" title="Users">Users</a></li>

<li class="page_item page-item-2415"><a href="http://www.puppetlabs.com/puppet/what-customers-are-saying/" title="What Customers are Saying">What Customers are Saying</a></li>
                </ul>
              </li>
              <li>
                <ul>
                  <li class="page_item page-item-1977"><a href="http://forge.puppetlabs.com" title="Module Forge">Module Forge</a></li>
<li class="page_item page-item-751"><a href="http://www.puppetlabs.com/puppet/related-projects/dashboard/" title="Dashboard">Dashboard</a></li>
<li class="page_item page-item-753"><a href="http://www.puppetlabs.com/puppet/related-projects/facter/" title="Facter">Facter</a></li>

                </ul>
              </li>
            </ul>
          </li>
          <li id="services-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/services/">
              <span>Services</span>
              <span class="drop-down-trigger"></span>

            </a>
            <ul>
              <li class="page_item page-item-783"><a href="http://www.puppetlabs.com/services/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-839"><a href="http://www.puppetlabs.com/services/support/" title="Enterprise Support">Enterprise Support</a></li>
<li class="page_item page-item-845"><a href="http://www.puppetlabs.com/services/training-workshops/" title="On-Site Training &amp; Consulting">On-Site Training &amp; Consulting</a></li>
<li class="page_item page-item-849"><a href="/category/events/upcoming/" title="Events &amp; Public Training">Events &amp; Public Training</a></li>

<li class="page_item page-item-2424"><a href="http://www.puppetlabs.com/services/what-customers-are-saying/" title="What Customers are Saying">What Customers are Saying</a></li>
<li class="page_item page-item-851"><a href="http://www.puppetlabs.com/services/partners/" title="Partners">Partners</a></li>
<li class="page_item page-item-1037"><a href="/resources/customer-support" title="Customer Support">Customer Support</a></li>
            </ul>
          </li>
          <li id="resources-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/resources/">
              <span>Resources</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-1048"><a href="http://www.puppetlabs.com/resources/overview-2/" title="Overview">Overview</a></li>
<li class="page_item page-item-833"><a href="http://www.puppetlabs.com/resources/case-studies/" title="Case Studies">Case Studies</a></li>
<li class="page_item page-item-1052"><a href="http://www.puppetlabs.com/resources/customer-support/" title="Customer Support">Customer Support</a></li>
<li class="page_item page-item-1040"><a href="http://docs.puppetlabs.com" title="Documentation">Documentation</a></li>
<li class="page_item page-item-872"><a href="http://info.puppetlabs.com/register-download" title="Downloads">Downloads</a></li>

<li class="page_item page-item-1961"><a href="http://forge.puppetlabs.com" title="Module Forge">Module Forge</a></li>
<li class="page_item page-item-835"><a href="http://info.puppetlabs.com/request-whitepapers.html" title="White Papers">White Papers</a></li>
<li class="page_item page-item-1967"><a href="http://projects.puppetlabs.com/projects/puppet/wiki" title="Wiki">Wiki</a></li>
            </ul>

          </li>
          <li id="community-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/community/">
              <span>Community</span>

              <span class="drop-down-trigger"></span>
            </a>
            <ul>
              <li class="page_item page-item-2195"><a href="http://www.puppetlabs.com/community/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-2264"><a href="http://www.puppetlabs.com/community/puppet-camp/" title="Puppet Camp">Puppet Camp</a></li>
<li class="page_item page-item-2249"><a href="http://www.puppetlabs.com/community/user-groups-and-devops-groups/" title="User Groups &amp; DevOps Groups">User Groups &amp; DevOps Groups</a></li>
<li class="page_item page-item-2215"><a href="http://www.puppetlabs.com/community/presentations/" title="Presentations">Presentations</a></li>

<li class="page_item page-item-2217"><a href="http://www.puppetlabs.com/community/videos/" title="Videos">Videos</a></li>
            </ul>
          </li>

          <li id="company-tab" class="with-submenu">
            <a href="http://www.puppetlabs.com/company/">
              <span>Company</span>
              <span class="drop-down-trigger"></span>
            </a>

            <ul>
              <li class="page_item page-item-2316"><a href="http://www.puppetlabs.com/company/overview/" title="Overview">Overview</a></li>
<li class="page_item page-item-2179"><a href="http://www.puppetlabs.com/company/news/" title="News">News</a></li>
<li class="page_item page-item-1571"><a href="http://www.puppetlabs.com/company/jobs/" title="Jobs">Jobs</a></li>
<li class="page_item page-item-2313"><a href="http://www.puppetlabs.com/company/contact-us/" title="Contact Us">Contact Us</a></li>
            </ul>
          </li>
    		</ul>	   
          <div id="misc-navigation">

			  <ul>
				<li><a href="http://docs.puppetlabs.com">Documentation</a></li>
				<li><a href="http://puppetlabs.com/resources/customer-support/">Support</a></li>
				<li><a href="http://projects.puppetlabs.com/">Bug Tracker</a></li>
				<li><a href="http://puppetlabs.com/company/#contact">Contact Us</a></li>
				<li><a href="http://puppetlabs.com/resources/downloads" class="gateway">Download</a></li>
			  </ul>
			<form action="http://www.google.com/cse" id="cse-search-box">

			  <div>
				<input type="hidden" name="cx" value="017884045025332504017:1mnj-dlgfcc" />
				<input type="hidden" name="ie" value="UTF-8" />
				<input type="text" name="q" size="31" />
				<input type="submit" name="sa" class="searchbtn" value="Search" />
			  </div>
			</form>
			<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en"></script>

          </div>
      </nav>
    	</div>
    </header>  

      <section id="masthead">
        <div class="site-width">
          <h1>Docs: <span class="section-name">Language Guide</span></h1>
          <ul id="doc-navigation">
            <li><a href="/">Docs Home</a></li>
            <li class="with-submenu">
              <a href="#">
                <span>Quick Nav</span>
                <span class="drop-down-trigger"></span>
              </a>
               <!-- the following links can't be relative, unfortunately -->
               <!-- future: add some JS to disable this if running from file:// -->
	            <dl>
	              <dt>Puppet Guides</dt>
                      <dd><a href="/index.html">Index</a></dd>
                  <dt>Puppet References</dt>
                      <dd><a href="/references/latest/type.html">Resource Types</a></dd>
                      <dd><a href="/references/latest/function.html">Functions</a></dd>
                      <dd><a href="/references/latest/metaparameter.html">Metaparameters</a></dd>
                      <dd><a href="/references/latest/configuration.html">Configuration</a></dd>
                  <dt>References By Version</dt>
                      <dd><a href="/references/2.6.6/">2.6.6</a></dd>
                      <dd><a href="/references/0.25.5/">0.25.5</a></dd> 
                      <dd><a href="/references/0.24.8/">0.24.8</a></dd>
                      <dd><a href="/references/">Other Versions</a></dd>
                  <dt>MCollective</dt>
                      <dd><a href="/mcollective/index.html">Index</a></dd>
                      <dd><a href="/mcollective/simplerpc/index.html">SimpleRPC</a></dd>
                      <dd><a href="/mcollective/roadmap/index.html">Roadmap</a></dd>
                      <dd><a href="/mcollective/releasenotes.html">Release Notes</a></dd>
                      <dd><a href="/mcollective/reference/index.html">References</a></dd>
	            </dl>
            </li>
            <li><a href="/contribute.html">Contribute</a></li>
          </ul>
        </div>
      </section>
    
      <section id="content">
        <div class="site-width">
          <div class="primary-secondary-content">
            <div class="primary-content">
              <h1 id="language-guide">Language Guide</h1>

<p>The purpose of Puppet&rsquo;s language is to make it easy to specify the
resources you need to manage on the machines you&rsquo;re managing.</p>

<p>This guide will show you how the language works, going through
some basic concepts.  Understanding
the Puppet language is key, as it&rsquo;s the main driver of how
you tell your Puppet managed machines what to do.</p>

<hr />

<h2 id="ready-to-dive-in">Ready To Dive In?</h2>

<p>Puppet language is really relatively simple compared to many
programming languages.  As you are reading over this guide,
it may also be helpful to look over various Puppet modules
people have already written.   Complete real world examples
can serve as a great introduction to Puppet.  See the <a href="/guides/modules.html">Modules</a>
page for more information and some links to list of community developed Puppet content.</p>

<h2 id="language-feature-by-release">Language Feature by Release</h2>

<table>
  <col />
  <col align="center" />
  <col align="center" />
  <col align="center" />
  <col align="center" />
  <col align="center" />
  <thead>
    <tr>
      <th>Feature</th>
      <th>0.23.1</th>
      <th>0.24.6</th>
      <th>0.24.7</th>
      <th>0.25.0</th>
      <th>2.6.0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Plusignment operator (+&gt;)</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
    </tr>
    <tr>
      <td>Multiple Resource relationships</td>
      <td>&nbsp;</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
    </tr>
    <tr>
      <td>Class Inheritance Overrides</td>
      <td>&nbsp;</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
    </tr>
    <tr>
      <td>Appending to Variables (+=)</td>
      <td>&nbsp;</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
    </tr>
    <tr>
      <td>Class names starting with 0-9</td>
      <td>&nbsp;</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
    </tr>
    <tr>
      <td>Multi-line C-style comments</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>X</td>
      <td>X</td>
      <td>X</td>
    </tr>
    <tr>
      <td>Node regular expressions</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>X</td>
      <td>X</td>
    </tr>
    <tr>
      <td>Expressions in Variables</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>X</td>
      <td>X</td>
    </tr>
    <tr>
      <td>RegExes in conditionals</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>X</td>
      <td>X</td>
    </tr>
    <tr>
      <td>Elsif in conditionals</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>X</td>
    </tr>
    <tr>
      <td>Chaining Resources</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>X</td>
    </tr>
    <tr>
      <td>Hashes</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>X</td>
    </tr>
    <tr>
      <td>Parameterised Class</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>X</td>
    </tr>
    <tr>
      <td>Run Stages</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>X</td>
    </tr>
    <tr>
      <td>The &ldquo;in&rdquo; syntax</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>X</td>
    </tr>
  </tbody>
</table>

<h2 id="resources">Resources</h2>

<p>The fundamental unit of modelling in Puppet is a resource.  Resources
describe some aspect of a system; it might be a file, a service, a
package, or perhaps even a custom resource that you have developed.
We&rsquo;ll show later how resources can be aggregated together with
&ldquo;defines&rdquo; and &ldquo;classes&rdquo;, and even show how to organize things
with &ldquo;modules&rdquo;, but resources are what we should start with first.</p>

<p>Each resource has a type, a title, and a list
of attributes &mdash; each resource in Puppet can support various attributes,
though many of them will have reasonable defaults and you won&rsquo;t have
to specify all of them.</p>

<p>You can find all of the supported resource
types, their valid attributes, and documentation for all of it in
the <a href="/references/stable/type.html">References</a>.</p>

<p>Let&rsquo;s get started.   Here&rsquo;s a simple example of a resource in Puppet,
where we are describing the permissions and ownership of a file:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;/etc/passwd&#39;</span><span class="p">:</span>
        <span class="n">owner</span> <span class="o">=&gt;</span> <span class="n">root</span><span class="p">,</span>
        <span class="n">group</span> <span class="o">=&gt;</span> <span class="n">root</span><span class="p">,</span>
        <span class="n">mode</span>  <span class="o">=&gt;</span> <span class="mi">644</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Any machine on which this snippet is executed will use it to verify
that the passwd file is configured as specified. The field before
the colon is the resource&rsquo;s <code>title</code>, which can be used to refer to
the resource in other parts of the Puppet configuration.</p>

<p>For simple resources that don&rsquo;t vary much, a single name is
sufficient.  However, what happens if a filename is different between
operating systems?   For these cases,
Puppet allows you to specify a local name in addition to the
title:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;sshdconfig&#39;</span><span class="p">:</span>
        <span class="nb">name</span> <span class="o">=&gt;</span> <span class="vg">$operatingsystem</span> <span class="p">?</span> <span class="p">{</span>
            <span class="n">solaris</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/local/etc/ssh/sshd_config&#39;</span><span class="p">,</span>
            <span class="n">default</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc/ssh/sshd_config&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">owner</span> <span class="o">=&gt;</span> <span class="n">root</span><span class="p">,</span>
        <span class="n">group</span> <span class="o">=&gt;</span> <span class="n">root</span><span class="p">,</span>
        <span class="n">mode</span>  <span class="o">=&gt;</span> <span class="mi">644</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>By using the title, which is always the same, it&rsquo;s easy to refer
to the file resource elsewhere in our configuration without having
to repeat that OS specific logic.</p>

<p>For instance, let&rsquo;s add a service that depends on the file:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">service</span> <span class="p">{</span> <span class="s1">&#39;sshd&#39;</span><span class="p">:</span>
        <span class="n">subscribe</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">[</span><span class="n">sshdconfig</span><span class="o">]</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>This will cause the <code>sshd</code> service to get restarted when the
<code>sshdconfig</code> file changes. You&rsquo;ll notice that when we reference a
resource we capitalise the name of the resource, for example
<code>File[sshdconfig]</code>.   When you see an uppercase resource type,
that&rsquo;s always a reference.  A lowercase version is a declaration.
Since resources can only be declared once, repeating the same
declaration twice will cause an error.   This is an important
feature of Puppet that makes sure your configuration is well
modelled.</p>

<p>What happens if our resource depends on multiple resources?
From Puppet version 0.24.6 you can specify multiple relationships
like so:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">service</span> <span class="p">{</span> <span class="s1">&#39;sshd&#39;</span><span class="p">:</span>
        <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">[</span><span class="s1">&#39;sshdconfig&#39;</span><span class="p">,</span> <span class="s1">&#39;sshconfig&#39;</span><span class="p">,</span> <span class="s1">&#39;authorized_keys&#39;</span><span class="o">]</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>It&rsquo;s important to note here that the title alone identifies the resource.
Even if the resource seems to conceptually point to the same entity,
it&rsquo;s the title that matters.  The following is possible in Puppet,
but is to be avoided as it can lead to errors once things get
sent down to the client.</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;sshdconfig&#39;</span><span class="p">:</span>
        <span class="nb">name</span>  <span class="o">=&gt;</span> <span class="s1">&#39;/usr/local/etc/ssh/sshd_config&#39;</span><span class="p">,</span>
        <span class="n">owner</span> <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;/usr/local/etc/ssh/sshd_config&#39;</span><span class="p">:</span>
        <span class="n">owner</span> <span class="o">=&gt;</span> <span class="s1">&#39;sshd&#39;</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<h3 id="metaparameters">Metaparameters</h3>

<p>In addition to the attributes specific to each Resource Type Puppet also has
global attributes called metaparameters. Metaparameters are
parameters that work with any resource type.</p>

<p>In the examples in the section above we used two metaparameters,
<code>subscribe</code> and <code>require</code>, both of which build relationships
between resources. You can see the full list of all metaparameters in the
<a href="/references/stable/metaparameter.html">Metaparameter Reference</a>, though
we&rsquo;ll point out additional ones we use as we continue the guide.</p>

<h3 id="resource-defaults">Resource Defaults</h3>

<p>Sometimes you will need to specify a default parameter value for a set
of resources; Puppet provides a syntax for doing this, using a
capitalized resource specification that has no title.  For instance,
in the example below, we&rsquo;ll set the default path for all execution
of commmands:</p>

<div class="highlight"><pre><code class="ruby">    <span class="no">Exec</span> <span class="p">{</span> <span class="n">path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/bin:/bin:/usr/sbin:/sbin&#39;</span> <span class="p">}</span>
    <span class="nb">exec</span> <span class="p">{</span> <span class="s1">&#39;echo this works&#39;</span><span class="p">:</span> <span class="p">}</span>
</code></pre>
</div>

<p>The first statement in this snippet provides a default value for
<code>exec</code> resources; Exec resources require either fully qualified paths or a
path in which to look for the executable. Individual resources can
still override this path when needed, but this saves typing.
This way you can specify a single default path for your entire configuration, and then override that value as necessary.</p>

<p>Defaults work with any resource type in Puppet.</p>

<p>Defaults are not global &mdash; they only affect the current scope and scopes below the current one.  If you want a default setting to affect your entire configuration, your only choice currently is to specify them outside of any class.  We&rsquo;ll mention classes in the next section.</p>

<h3 id="resource-collections">Resource Collections</h3>

<p>Aggregation is a powerful concept in Puppet.  There are two ways to combine multiple resources into one easier to use resource: Classes and defined resource types. Classes model fundamental aspects of nodes, they say &ldquo;this node IS a webserver&rdquo; or &ldquo;this node is one of these&rdquo;.  In programming terminology classes are
singletons &mdash; they only ever get evaluated once per node.</p>

<p>Defined resource types, on the other hand, can be reused many times on the same node.  They essentially work as if you created your own Puppet type just by using the language.  They are meant to be evaluated multiple times, with different inputs each time.  This means you can pass variable values into the defines.</p>

<p>Both classes and defines are very useful and you should make use of them when building out your puppet infrastructure.</p>

<h4 id="classes">Classes</h4>

<p>Classes are introduced with the <code>class</code> keyword, and their contents
are wrapped in curly braces.  The following simple example creates a simple class that manages two separate files:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="n">unix</span> <span class="p">{</span>
        <span class="n">file</span> <span class="p">{</span>
            <span class="s1">&#39;/etc/passwd&#39;</span><span class="p">:</span>
                <span class="n">owner</span> <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
                <span class="n">group</span> <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
                <span class="n">mode</span>  <span class="o">=&gt;</span> <span class="mi">644</span><span class="p">;</span>
            <span class="s1">&#39;/etc/shadow&#39;</span><span class="p">:</span>
                <span class="n">owner</span> <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
                <span class="n">group</span> <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
                <span class="n">mode</span>  <span class="o">=&gt;</span> <span class="mi">440</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>You&rsquo;ll notice we introduced some shorthand here.   This is the same
as saying:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="n">unix</span> <span class="p">{</span>
        <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;/etc/passwd&#39;</span><span class="p">:</span>
             <span class="n">owner</span> <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
             <span class="n">group</span> <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
             <span class="n">mode</span>  <span class="o">=&gt;</span> <span class="mi">644</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;/etc/shadow&#39;</span><span class="p">:</span>
             <span class="n">owner</span> <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
             <span class="n">group</span> <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
             <span class="n">mode</span>  <span class="o">=&gt;</span> <span class="mi">440</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Classes also support a simple form of object inheritance.  For those
not acquainted with programming terms, this means that we can extend
the functionality of the previous class without copy/pasting
the entire class.  Inheritance allows
subclasses to override resource settings defined in parent classes. A
class can only inherit from one other class, not more than one.
In programming terms, this is called &lsquo;single inheritance&rsquo;.</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="n">freebsd</span> <span class="n">inherits</span> <span class="n">unix</span> <span class="p">{</span>
        <span class="no">File</span><span class="o">[</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="o">]</span> <span class="p">{</span> <span class="n">group</span> <span class="o">=&gt;</span> <span class="n">wheel</span> <span class="p">}</span>
        <span class="no">File</span><span class="o">[</span><span class="s1">&#39;/etc/shadow&#39;</span><span class="o">]</span> <span class="p">{</span> <span class="n">group</span> <span class="o">=&gt;</span> <span class="n">wheel</span> <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>If we needed to undo some logic specified in a parent class, we can
use undef like so:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="n">freebsd</span> <span class="n">inherits</span> <span class="n">unix</span> <span class="p">{</span>
        <span class="no">File</span><span class="o">[</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="o">]</span> <span class="p">{</span> <span class="n">group</span> <span class="o">=&gt;</span> <span class="k">undef</span> <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In the above example, nodes which include the <code>unix</code> class will have the
password file&rsquo;s group set to <code>root</code>, while nodes including
<code>freebsd</code> would have the password file group ownership left
unmodified.</p>

<p>In Puppet version 0.24.6 and higher, you can specify multiple overrides like
so:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="n">freebsd</span> <span class="n">inherits</span> <span class="n">unix</span> <span class="p">{</span>
        <span class="no">File</span><span class="o">[</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">,</span> <span class="s1">&#39;/etc/shadow&#39;</span><span class="o">]</span> <span class="p">{</span> <span class="n">group</span> <span class="o">=&gt;</span> <span class="n">wheel</span> <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>There are other ways to use inheritance.  In Puppet 0.23.1 and
higher, it&rsquo;s possible to add values to resource parameters using
the &lsquo;+&gt;&rsquo; (&lsquo;plusignment&rsquo;) operator:</p>

<div class="highlight"><pre><code class="ruby">    
    <span class="k">class</span> <span class="n">apache</span> <span class="p">{</span>
        <span class="n">service</span> <span class="p">{</span> <span class="s1">&#39;apache&#39;</span><span class="p">:</span> <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Package</span><span class="o">[</span><span class="s1">&#39;httpd&#39;</span><span class="o">]</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">class</span> <span class="n">apache</span><span class="o">-</span><span class="n">ssl</span> <span class="n">inherits</span> <span class="n">apache</span> <span class="p">{</span>
        <span class="c1"># host certificate is required for SSL to function</span>
        <span class="no">Service</span><span class="o">[</span><span class="n">apache</span><span class="o">]</span> <span class="p">{</span> <span class="nb">require</span> <span class="o">+&gt;</span> <span class="no">File</span><span class="o">[</span><span class="s1">&#39;apache.pem&#39;</span><span class="o">]</span> <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>The above example makes the second class require all the packages in the first,
with the addition of &lsquo;apache.pem&rsquo;.</p>

<p>To append multiple requires, use array brackets and commas:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="n">apache</span> <span class="p">{</span>
        <span class="n">service</span> <span class="p">{</span> <span class="s1">&#39;apache&#39;</span><span class="p">:</span> <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Package</span><span class="o">[</span><span class="s1">&#39;httpd&#39;</span><span class="o">]</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">class</span> <span class="n">apache</span><span class="o">-</span><span class="n">ssl</span> <span class="n">inherits</span> <span class="n">apache</span> <span class="p">{</span>
        <span class="no">Service</span><span class="o">[</span><span class="n">apache</span><span class="o">]</span> <span class="p">{</span> <span class="nb">require</span> <span class="o">+&gt;</span> <span class="o">[</span> <span class="no">File</span><span class="o">[</span><span class="s1">&#39;apache.pem&#39;</span><span class="o">]</span><span class="p">,</span> <span class="no">File</span><span class="o">[</span><span class="s1">&#39;/etc/httpd/conf/httpd.conf&#39;</span><span class="o">]</span> <span class="o">]</span> <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>The above would make the <code>require</code> parameter in the <code>apache-ssl</code>
class equal to</p>

<div class="highlight"><pre><code class="ruby">    <span class="o">[</span><span class="no">Package</span><span class="o">[</span><span class="s1">&#39;httpd&#39;</span><span class="o">]</span><span class="p">,</span> <span class="no">File</span><span class="o">[</span><span class="s1">&#39;apache.pem&#39;</span><span class="o">]</span><span class="p">,</span> <span class="no">File</span><span class="o">[</span><span class="s1">&#39;/etc/httpd/conf/httpd.conf&#39;</span><span class="o">]]</span>
</code></pre>
</div>

<p>Like resources, you can also create relationships between classes with
&lsquo;require&rsquo;, like so:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="n">apache</span> <span class="p">{</span>
        <span class="n">service</span> <span class="p">{</span> <span class="s1">&#39;apache&#39;</span><span class="p">:</span> <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Class</span><span class="o">[</span><span class="s1">&#39;squid&#39;</span><span class="o">]</span> <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>The above example uses the <code>require</code> metaparameter to make the <code>apache</code>
class dependent on the <code>squid</code> class.</p>

<p>In Puppet version 0.24.6 and higher, you can specify multiple relationships
like so:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="n">apache</span> <span class="p">{</span>
        <span class="n">service</span> <span class="p">{</span> <span class="s1">&#39;apache&#39;</span><span class="p">:</span>
                      <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Class</span><span class="o">[</span><span class="s1">&#39;squid&#39;</span><span class="p">,</span> <span class="s1">&#39;xml&#39;</span><span class="p">,</span> <span class="s1">&#39;jakarta&#39;</span><span class="o">]</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>It&rsquo;s not dangerous to reference a class with a require more than once.
Classes are evaluated using the <code>include</code> function (which we will
mention later). If a class has already been evaluated once, then <code>include</code> essentially does nothing.</p>

<h4 id="parameterised-classes">Parameterised Classes</h4>

<p>In Puppet release 2.6.0 and later, classes are extended to allow the passing of parameters into classes.</p>

<p>To create a class with parameters you can now specify:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="n">apache</span><span class="p">(</span><span class="vg">$version</span><span class="p">)</span> <span class="p">{</span>
      <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="k">class</span> <span class="n">contents</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Classes with parameters are not declared using the include function but with an alternate syntax similar to a resource declaration:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">node</span> <span class="n">webserver</span> <span class="p">{</span>
      <span class="k">class</span> <span class="p">{</span> <span class="n">apache</span><span class="p">:</span> <span class="n">version</span> <span class="o">=&gt;</span> <span class="s2">&quot;1.3.13&quot;</span> <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>You can also specify default parameter values in your class like so:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="n">apache</span><span class="p">(</span><span class="vg">$version</span><span class="o">=</span><span class="s2">&quot;1.3.13&quot;</span><span class="p">,</span><span class="vg">$home</span><span class="o">=</span><span class="s2">&quot;/var/www&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="k">class</span> <span class="n">contents</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span>
    <span class="p">}</span>
</code></pre>
</div>

<h4 id="run-stages">Run Stages</h4>

<p>Run stage were added in Puppet version 2.6.0, you now have the ability to specify any
number of stages which provide another method to control the ordering of
resource management in puppet.  If you have a large number of resources in your
catalog it may become tedious and cumbersome to explicitly manage every
relationship between the resources where order is important.  In this
situation, run-stages provides you the ability to associate a class to a single
stage.  Puppet will guarantee stages run in a specific predictable order every
catalog run.</p>

<p>In order to use run-stages, you must first declare additional stages beyond the
already present main stage.  You can then configure puppet to manage each stage
in a specific order using the same resource relationship syntax, before,
require, &ldquo;-&gt;&rdquo; and &ldquo;&lt;-&ldquo;.  The relationship of stages will then guarantee the
ordering of classes associated with each stage.</p>

<p>By default there is only one stage named &ldquo;main&rdquo; and all classes are
automatically associated with this stage.  Unless explicitly stated, a class
will be associated with the main stage.  With only one stage the effect of run
stages is the same as previous versions of puppet since resources within a
stage are managed in arbitrary order unless they have explicit relationships
declared.</p>

<p>In order to declare additional stage resources, follow the same consistent and
simple declarative syntax of the puppet language:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">stage</span> <span class="p">{</span> <span class="s2">&quot;first&quot;</span><span class="p">:</span> <span class="n">before</span> <span class="o">=&gt;</span> <span class="no">Stage</span><span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="p">}</span>
    <span class="n">stage</span> <span class="p">{</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Stage</span><span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="p">}</span>
</code></pre>
</div>

<p>All classes associated with the first stage are to be managed before the
classes associated with the main stage.  All classes associated with the
last stage are to be managed after the classes associated with the main
stage.</p>

<p>Once stages have been declared, a class may be associated with a stage other
than main using the &ldquo;stage&rdquo; class parameter.</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="p">{</span>
      <span class="s2">&quot;apt-keys&quot;</span><span class="p">:</span> <span class="n">stage</span> <span class="o">=&gt;</span> <span class="n">first</span><span class="p">;</span>
      <span class="s2">&quot;sendmail&quot;</span><span class="p">:</span> <span class="n">stage</span> <span class="o">=&gt;</span> <span class="n">main</span><span class="p">;</span>
      <span class="s2">&quot;apache&quot;</span><span class="p">:</span>   <span class="n">stage</span> <span class="o">=&gt;</span> <span class="n">last</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Associate all resources in the class apt-keys with the first run stage, all
resources in the class sendmail with the main stage, and all resources in the
apache class with the last stage.</p>

<p>This short declaration guarantees resources in the apt-keys class are managed
before resources in the sendmail class, which in turn is managed before
resources in the apache class.</p>

<p>Please note that stage is not a metaparameter.  The run stage must be specified
as a class parameter and as such classes must use the resource declaration
syntax as shown rather than the &ldquo;include&rdquo; statement.</p>

<h4 id="defined-resource-types">Defined Resource Types</h4>

<p>Defined resource types follow the same basic form as classes, but they are introduced with the 
<code>define</code> keyword (not <code>class</code>) and they support arguments but no inheritance.  As 
mentioned previously, defined resource types take parameters and can be reused multiple times on the same system.   Suppose we want to create a resource collection that creates source control 
repositories.  We probably would want to create multiple repositories on the same 
system, so we would use a defined type, not a class.  Here&rsquo;s an example:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">define</span> <span class="n">svn_repo</span><span class="p">(</span><span class="vg">$path</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">exec</span> <span class="p">{</span> <span class="s2">&quot;/usr/bin/svnadmin create $path/$title&quot;</span><span class="p">:</span>
            <span class="k">unless</span> <span class="o">=&gt;</span> <span class="s2">&quot;/bin/test -d $path&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">svn_repo</span> <span class="p">{</span> <span class="n">puppet_repo</span><span class="p">:</span> <span class="n">path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/svn_puppet&#39;</span> <span class="p">}</span>
    <span class="n">svn_repo</span> <span class="p">{</span> <span class="n">other_repo</span><span class="p">:</span>  <span class="n">path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/svn_other&#39;</span> <span class="p">}</span>
</code></pre>
</div>

<p>Note how parameters specified in the definition (<code>define svn_repo($path)</code>) must appear as resource attributes (<code>path =&gt; '/var/svn_puppet'</code>) whenever a resource of the new type is declared and are available as variables (<code>unless =&gt; "/bin/test -d $path"</code>) within the definition. Multiple variables (separated by commas) can be specified. Default values can also be specified for any parameter with <code>=</code>, and any parameter which has a default becomes non-mandatory when a resource of the new type is declared. </p>

<p>Defined types have a number of built-in variables available, including <code>$name</code> and <code>$title</code>, which are set to the title of the resource when it is declared. (The reasons for having two identical variables with this information are outside the scope of this document, and these two special variables cannot be used the same way in classes or other resources.) As of Puppet 2.6.5, the <code>$name</code> and <code>$title</code> variables can also be used as default values for parameters:</p>

<pre><code>define svn_repo($path = "/var/$name") {...}
</code></pre>

<p>Any metaparameters used when a defined resource is declared are also made available in the definition as variables: </p>

<div class="highlight"><pre><code class="ruby">    <span class="n">define</span> <span class="n">svn_repo</span><span class="p">(</span><span class="vg">$path</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">exec</span> <span class="p">{</span><span class="s2">&quot;create_repo_${name}&quot;</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=&gt;</span> <span class="s2">&quot;/usr/bin/svnadmin create $path/$title&quot;</span><span class="p">,</span>
            <span class="k">unless</span> <span class="o">=&gt;</span> <span class="s2">&quot;/bin/test -d $path&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="vg">$require</span> <span class="p">{</span>
            <span class="no">Exec</span><span class="o">[</span><span class="s2">&quot;create_repo_${name}&quot;</span><span class="o">]</span><span class="p">{</span>
                <span class="nb">require</span> <span class="o">+&gt;</span> <span class="vg">$require</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">svn_repo</span> <span class="p">{</span> <span class="n">puppet</span><span class="p">:</span>
       <span class="n">path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/svn&#39;</span><span class="p">,</span>
       <span class="nb">require</span> <span class="o">=&gt;</span> <span class="no">Package</span><span class="o">[</span><span class="n">subversion</span><span class="o">]</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>The above is perhaps not a perfect example, as most likely we would
know that subversion was always required for svn checkouts, but it illustrates how <code>require</code> and other metaparameters can be used in defined types.</p>

<h4 id="classes-vs-defined-resource-types">Classes vs. Defined Resource Types</h4>

<p>Classes and defined types are created similarly, but they are used very differently.</p>

<p>Defined types are used to define reusable objects which will have
multiple instances on a given host, so they cannot include any
resources that will only have one instance.  For instance, multiple
uses of the same define cannot create the same file.</p>

<p>Classes, on the other hand, are guaranteed to be singletons &mdash; you
can include them as many times as you want and you&rsquo;ll only ever
get one copy of the resources.</p>

<p>Most often, services will be defined in a class, where the
service&rsquo;s package, configuration files, and running service will
all be gathered, because there will normally be one
copy of each on a given host.   (This idiom is sometimes
referred to as &ldquo;service-package-file&rdquo;).</p>

<p>Defined types would be used to manage resources like virtual hosts, of 
which you can have many, or to encode some simple information in a reusable 
wrapper to save typing.</p>

<h4 id="modules">Modules</h4>

<p>You can (and should!) combine collections of classes, defined types, and resources
into modules. Modules are portable collections of configuration,
for example a module might contain all the resources required to
configure Postfix or Apache. You can find out more on the
<a href="./modules.html">Modules Page</a></p>

<h3 id="chaining-resources">Chaining resources</h3>

<p>As of puppet version 2.6.0, resources may be chained together to declare
relationships between and among them.</p>

<p>You can now specify relationships directly as statements in addition to
the before and require resource metaparameters of previous versions:</p>

<div class="highlight"><pre><code class="ruby">    <span class="no">File</span><span class="o">[</span><span class="s2">&quot;/etc/ntp.conf&quot;</span><span class="o">]</span> <span class="o">-&gt;</span> <span class="no">Service</span><span class="o">[</span><span class="n">ntpd</span><span class="o">]</span>
</code></pre>
</div>

<p>Manage the ntp configuration file before the ntpd service</p>

<p>You can specify a &ldquo;notify&rdquo; relationship by employing the tilde instead of the
hyphen:</p>

<div class="highlight"><pre><code class="ruby">    <span class="no">File</span><span class="o">[</span><span class="s2">&quot;/etc/ntp.conf&quot;</span><span class="o">]</span> <span class="o">~&gt;</span> <span class="no">Service</span><span class="o">[</span><span class="n">ntpd</span><span class="o">]</span>
</code></pre>
</div>

<p>This manages the ntp configuration file before the ntpd service and notifies the
service of changes to the ntp configuration file.</p>

<p>You can also do relationship chaining, specifying multiple relationships on a
single line:</p>

<div class="highlight"><pre><code class="ruby">    <span class="no">Package</span><span class="o">[</span><span class="n">ntp</span><span class="o">]</span> <span class="o">-&gt;</span> <span class="no">File</span><span class="o">[</span><span class="s2">&quot;/etc/ntp.conf&quot;</span><span class="o">]</span> <span class="o">-&gt;</span> <span class="no">Service</span><span class="o">[</span><span class="n">ntpd</span><span class="o">]</span>
</code></pre>
</div>

<p>Here we first manage the ntp package, second manage the ntp configuration file, 
and third manage the ntpd service.</p>

<p>Note that while it&rsquo;s confusing, you don&rsquo;t have to have all of the arrows be the
same direction:</p>

<div class="highlight"><pre><code class="ruby">    <span class="no">File</span><span class="o">[</span><span class="s2">&quot;/etc/ntp.conf&quot;</span><span class="o">]</span> <span class="o">-&gt;</span> <span class="no">Service</span><span class="o">[</span><span class="n">ntpd</span><span class="o">]</span> <span class="o">&lt;-</span> <span class="no">Package</span><span class="o">[</span><span class="n">ntp</span><span class="o">]</span>
</code></pre>
</div>

<p>Here the ntpd service requires /etc/ntp.conf and the ntp package.</p>

<p>Please note, relationships declared in this manner are between adjacent
resources.  In this example, the ntp package and the ntp configuration file are
related to each other and puppet may try to manage the configuration file
before the package is even installed, which may not be the desired behavior.</p>

<p>Chaining in this manner can provide some succinctness at the cost of
readability.</p>

<p>You can also specify relationships when resources are declared, in addition to
the above resource reference examples:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">package</span> <span class="p">{</span> <span class="s2">&quot;ntp&quot;</span><span class="p">:</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="n">file</span> <span class="p">{</span> <span class="s2">&quot;/etc/ntp.conf&quot;</span><span class="p">:</span> <span class="p">}</span>
</code></pre>
</div>

<p>Here we manage the ntp package before the ntp configuration file.</p>

<p>But wait! There&rsquo;s more! You can also specify a collection on either side
of the relationship marker:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">yumrepo</span> <span class="p">{</span> <span class="n">localyumrepo</span><span class="p">:</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span> <span class="p">}</span>
    <span class="n">package</span> <span class="p">{</span> <span class="n">ntp</span><span class="p">:</span> <span class="n">provider</span> <span class="o">=&gt;</span> <span class="n">yum</span><span class="p">,</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span>
    <span class="no">Yumrepo</span> <span class="o">&lt;|</span> <span class="o">|&gt;</span> <span class="o">-&gt;</span> <span class="no">Package</span> <span class="o">&lt;|</span> <span class="n">provider</span> <span class="o">==</span> <span class="n">yum</span> <span class="o">|&gt;</span>
</code></pre>
</div>

<p>This manages all yum repository resources before managing all package resources
using the yum provider.</p>

<p>This, finally, provides easy many to many relationships in Puppet, but it also
opens the door to massive dependency cycles. This last feature is a very
powerful stick, and you can considerably hurt yourself with it.</p>

<h3 id="nodes">Nodes</h3>

<p>Having knowledge of resources, classes, defines, and modules
gets you to understanding of most of Puppet.   Nodes are a very
simple remaining step, which are how we map the what we define
(&ldquo;this is what a webserver looks like&rdquo;) to what machines are
chosen to fulfill those instructions.</p>

<p>Node definitions look just like classes, including supporting
inheritance, but they are special in that when a node (a managed
computer running the Puppet client) connects to the Puppet master daemon, its
name will be looked for in the list of defined nodes.   The information
found for the node will then be evaluated for that node, and then node will
be sent that configuration.</p>

<p>Node names can be the short host name, or the fully qualified
domain name (FQDN).  Some names, especially fully qualified ones,
need to be quoted, so it is a best practice to quote all of them.
Here&rsquo;s an example:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">node</span> <span class="s1">&#39;www.testing.com&#39;</span> <span class="p">{</span>
       <span class="kp">include</span> <span class="n">common</span>
       <span class="kp">include</span> <span class="n">apache</span><span class="p">,</span> <span class="n">squid</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>The previous node definition creates a node called
<code>www.testing.com</code> and includes the <code>common</code>, <code>apache</code> and <code>squid</code>
classes.</p>

<p>You can also specify that multiple nodes receive an identical
configuration by separating each with a comma:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">node</span> <span class="s1">&#39;www.testing.com&#39;</span><span class="p">,</span> <span class="s1">&#39;www2.testing.com&#39;</span><span class="p">,</span> <span class="s1">&#39;www3.testing.com&#39;</span> <span class="p">{</span>
       <span class="kp">include</span> <span class="n">common</span>
       <span class="kp">include</span> <span class="n">apache</span><span class="p">,</span> <span class="n">squid</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>The previous examples creates three identical nodes:
<code>www.testing.com</code>, <code>www2.testing.com</code>, and <code>www3.testing.com</code>.</p>

<h4 id="matching-nodes-with-regular-expressions">Matching Nodes with Regular Expressions</h4>

<p>In Puppet 0.25.0 and later, nodes can also be matched
by regular expressions, which is much more convenient than
listing them individually, one-by-one:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">node</span><span class="sr"> /^www\d+$/</span> <span class="p">{</span>
        <span class="kp">include</span> <span class="n">common</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>The above would match any host called <code>www</code> and ending with one or more
digits.  Here&rsquo;s another example:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">node</span><span class="sr"> /^(foo|bar)\.testing\.com$/</span> <span class="p">{</span>
        <span class="kp">include</span> <span class="n">common</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>The above example would match either host <code>foo</code> or <code>bar</code> in the testing.com
domain.</p>

<p>What happens if there are multiple regular expressions or node definitions
set in the same file?</p>

<ul>
  <li>If there is a node without a regular expression that matches
the current client connecting, that will be used first.</li>
  <li>Otherwise the first matching regular expression wins.</li>
</ul>

<h4 id="node-inheritance">Node Inheritance</h4>

<p>Nodes support a limited inheritance model.  Like classes, nodes
can only inherit from one other node:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">node</span> <span class="s1">&#39;www2.testing.com&#39;</span> <span class="n">inherits</span> <span class="s1">&#39;www.testing.com&#39;</span> <span class="p">{</span>
        <span class="kp">include</span> <span class="n">loadbalancer</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In this node definition the <code>www2.testing.com</code> inherits any
configuration specified for the <code>www.testing.com</code> node in addition
to including the <code>loadbalancer</code> class.   In other words, it does
everything &ldquo;www.testing.com&rdquo; does, but also takes on some
additional functionality.</p>

<h4 id="default-nodes">Default Nodes</h4>

<p>If you create a node named <code>default</code>, the node configuration
for default will be used if no other node matches are found.</p>

<h4 id="external-nodes">External Nodes</h4>

<p>In some cases you may already have an external list of machines
and what roles they perform.  This may be in LDAP, version
control, or a database.  You may also need to pass some
variables to those nodes (more on variables later).</p>

<p>In these cases, writing an <a href="./external_nodes.html">External Nodes</a>
script can help, and that can take the place of your node definitions.  See
that section for more information.</p>

<h2 id="additional-language-features">Additional Language Features</h2>

<p>We&rsquo;ve already gone over features such as ordering and
grouping, though there&rsquo;s still a few more things to learn.</p>

<p>Puppet is not a programming language, it is a way of describing
your IT infrastructure as a model.  This is usually quite
sufficient to get the job done, and prevents you from having
to write a lot of programming code.</p>

<h3 id="quoting">Quoting</h3>

<p>Most of the time, you don&rsquo;t have to quote strings in Puppet.
Any alphanumeric string starting with a letter (hyphens are also allowed), can leave out the quotes, though it&rsquo;s a best practice to quote strings
for any non-native value.</p>

<h3 id="variable-interpolation-with-quotes">Variable Interpolation With Quotes</h3>

<p>So far, we&rsquo;ve mentioned variables in terms of defines.  If you
need to use those variables within a string, use double quotes,
not single quotes.   Single-quoted strings will not do any variable interpolation,  double-quoted strings will. Variables in strings can also be bracketed with <code>{}</code> which makes them easier to use together, and also a bit cleaner to read:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$value</span> <span class="o">=</span> <span class="s2">&quot;${one}${two}&quot;</span>
</code></pre>
</div>

<p>To put a quote character or <code>$</code> in a double-quoted string where it would
normally have a special meaning, precede it with an escaping <code>\</code>. For an actual <code>\</code>, use <code>\\</code>.</p>

<p>We recommend using single quotes for all strings that do not require variable interpolation. Use double quotes for those strings that require variable interpolation.</p>

<h3 id="capitalization">Capitalization</h3>

<p>Capitalization of resources is used in three major ways:</p>

<ul>
  <li>Referencing: when you want to reference an already declared resource, usually for dependency purposes, you have to capitalize the name of the resource, for example</li>
</ul>

<div class="highlight"><pre><code class="ruby">    <span class="sb">`require =&gt; File[sshdconfig]`</span><span class="o">.</span>
</code></pre>
</div>

<ul>
  <li>
    <p>Inheritance.  When overwriting the resource settings of a parent class from a subclass, use the uppercase versions of the resource names.  Using the lowercase versions will result in an error.   See the inheritance section above for an example of this.</p>
  </li>
  <li>
    <p>Setting default attribute values: Resource Defaults.  As mentioned previously, using a capitalized resource with no <code>title</code> works to set the defaults for that resource.  Our previous example was setting the default path for command executions.</p>
  </li>
</ul>

<h3 id="arrays">Arrays</h3>

<p>As mentioned in the class and resource examples above, Puppet allows usage of arrays in various areas.  Arrays defined in puppet look like this:</p>

<div class="highlight"><pre><code class="ruby">    <span class="o">[</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span> <span class="o">]</span>
</code></pre>
</div>

<p>You can access array entries by their index, for example:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$foo</span> <span class="o">=</span> <span class="o">[</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span> <span class="o">]</span>
    <span class="n">notice</span> <span class="vg">$foo</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</code></pre>
</div>

<p>Would return <code>two</code>.</p>

<p>Several type members, such as &lsquo;alias&rsquo; in the &lsquo;host&rsquo; definition
definition accept arrays as their value. A host resource with
multiple aliases would look like this:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">host</span> <span class="p">{</span> <span class="s1">&#39;one.example.com&#39;</span><span class="p">:</span>
        <span class="k">alias</span>  <span class="o">=&gt;</span> <span class="o">[</span> <span class="s1">&#39;satu&#39;</span><span class="p">,</span> <span class="s1">&#39;dua&#39;</span><span class="p">,</span> <span class="s1">&#39;tiga&#39;</span> <span class="o">]</span><span class="p">,</span>
        <span class="n">ip</span>     <span class="o">=&gt;</span> <span class="s1">&#39;192.168.100.1&#39;</span><span class="p">,</span>
        <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>This would add a host &lsquo;one.example.com&rsquo; to the hosts list with the
three aliases &lsquo;satu&rsquo;, &lsquo;dua&rsquo;, and &lsquo;tiga&rsquo;.</p>

<p>Or, for example, if you want a resource to require multiple other
resources, the way to do this would be like this:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">resource</span> <span class="p">{</span> <span class="s1">&#39;baz&#39;</span><span class="p">:</span>
        <span class="nb">require</span>  <span class="o">=&gt;</span> <span class="o">[</span> <span class="no">Package</span><span class="o">[</span><span class="s1">&#39;foo&#39;</span><span class="o">]</span><span class="p">,</span> <span class="no">File</span><span class="o">[</span><span class="s1">&#39;bar&#39;</span><span class="o">]</span> <span class="o">]</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Another example for array usage is to call a custom defined
resource multiple times, like this:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">define</span> <span class="n">php</span><span class="o">::</span><span class="n">pear</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">package</span> <span class="p">{</span> <span class="s2">&quot;`php-${name}&quot;</span><span class="p">:</span> <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">installed</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">php</span><span class="o">::</span><span class="n">pear</span> <span class="p">{</span> <span class="o">[</span><span class="s1">&#39;ldap&#39;</span><span class="p">,</span> <span class="s1">&#39;mysql&#39;</span><span class="p">,</span> <span class="s1">&#39;ps&#39;</span><span class="p">,</span> <span class="s1">&#39;snmp&#39;</span><span class="p">,</span> <span class="s1">&#39;sqlite&#39;</span><span class="p">,</span> <span class="s1">&#39;tidy&#39;</span><span class="p">,</span> <span class="s1">&#39;xmlrpc&#39;</span><span class="o">]</span><span class="p">:</span> <span class="p">}</span>
</code></pre>
</div>

<p>Of course, this can be used for native types as well:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">file</span> <span class="p">{</span> <span class="o">[</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;foobar&#39;</span> <span class="o">]</span><span class="p">:</span>
        <span class="n">owner</span> <span class="o">=&gt;</span> <span class="n">root</span><span class="p">,</span>
        <span class="n">group</span> <span class="o">=&gt;</span> <span class="n">root</span><span class="p">,</span>
        <span class="n">mode</span>  <span class="o">=&gt;</span> <span class="mi">600</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<h3 id="hashes">Hashes</h3>

<p>Since Puppet version 2.6.0, hashes have been supported in the language.  These hashes are defined like Ruby hashes using the form:</p>

<div class="highlight"><pre><code class="ruby">    <span class="p">{</span> <span class="n">key1</span> <span class="o">=&gt;</span> <span class="n">val1</span><span class="p">,</span> <span class="n">key2</span> <span class="o">=&gt;</span> <span class="n">val2</span><span class="p">,</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="p">}</span>
</code></pre>
</div>

<p>The hash keys are strings, but hash values can be any possible RHS values allowed in the language like function calls, variables, etc.</p>

<p>It is possible to assign hashes to a variable like so:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$myhash</span> <span class="o">=</span> <span class="p">{</span> <span class="n">key1</span> <span class="o">=&gt;</span> <span class="s2">&quot;myval&quot;</span><span class="p">,</span> <span class="n">key2</span> <span class="o">=&gt;</span> <span class="vg">$b</span> <span class="p">}</span>
</code></pre>
</div>

<p>And to access hash members (recursively) from a variable containing a hash (this also works for arrays too):</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$myhash</span> <span class="o">=</span> <span class="p">{</span> <span class="n">key</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="n">subkey</span> <span class="o">=&gt;</span> <span class="s2">&quot;b&quot;</span> <span class="p">}}</span>
    <span class="n">notice</span><span class="p">(</span><span class="vg">$myhash</span><span class="o">[</span><span class="n">key</span><span class="o">][</span><span class="n">subkey</span><span class="o">]]</span>
</code></pre>
</div>

<p>You can also use a hash member as a resource title, as a default definition parameter, or potentially as the value of a resource parameter,</p>

<h3 id="variables">Variables</h3>

<p>Puppet supports variables like most other languages you may be familiar with.  Puppet variables are denoted with <code>$</code>:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$content</span> <span class="o">=</span> <span class="s1">&#39;some content\n&#39;</span>

    <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;/tmp/testing&#39;</span><span class="p">:</span> <span class="n">content</span> <span class="o">=&gt;</span> <span class="vg">$content</span> <span class="p">}</span>
</code></pre>
</div>

<p>Puppet language is a declarative language, which means that its scoping and
assignment rules are somewhat different than a normal imperative
language. The primary difference is that you cannot change the
value of a variable within a single scope, because that would rely
on order in the file to determine the value of the variable.  Order
does not matter in a declarative language.  Doing so will result in an error:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$user</span> <span class="o">=</span> <span class="n">root</span>
    <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;/etc/passwd&#39;</span><span class="p">:</span>
        <span class="n">owner</span> <span class="o">=&gt;</span> <span class="vg">$user</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="vg">$user</span> <span class="o">=</span> <span class="n">bin</span>
    <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;/bin&#39;</span><span class="p">:</span>
        <span class="n">owner</span>   <span class="o">=&gt;</span> <span class="vg">$user</span><span class="p">,</span>
        <span class="n">recurse</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Rather than reassigning variables, instead use the built in conditionals:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$group</span> <span class="o">=</span> <span class="vg">$operatingsystem</span> <span class="p">?</span> <span class="p">{</span>
        <span class="n">solaris</span> <span class="o">=&gt;</span> <span class="s1">&#39;sysadmin&#39;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=&gt;</span> <span class="s1">&#39;wheel&#39;</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>A variable may only be assigned once per scope.  However you still can set the same variable in non-overlapping scopes. For example, to set top-level
configuration values:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">node</span> <span class="n">a</span> <span class="p">{</span>
        <span class="vg">$setting</span> <span class="o">=</span> <span class="s1">&#39;this&#39;</span>
        <span class="kp">include</span> <span class="n">class_using_setting</span>
    <span class="p">}</span>
    <span class="n">node</span> <span class="n">b</span> <span class="p">{</span>
        <span class="vg">$setting</span> <span class="o">=</span> <span class="s1">&#39;that&#39;</span>
        <span class="kp">include</span> <span class="n">class_using_setting</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In the above example, nodes &ldquo;a&rdquo; and &ldquo;b&rdquo; have different scopes, so this is
not reassignment of the same variable.</p>

<h4 id="variable-scope">Variable Scope</h4>

<p>Scoping may initially seem like a foreign concept, though in
reality it is pretty simple.   A scope defines where
a variable is valid.  Unlike early programming languages like BASIC,
variables are only valid and accessible in certain places in a
program.  Using the same variable name in different parts of
the language do not refer to the same value.</p>

<p>Classes and nodes introduce new scopes. Puppet is
currently dynamically scoped, which means that scope hierarchies
are created based on where the code is evaluated instead of where
the code is defined.</p>

<p>For example:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$test</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>
    <span class="k">class</span> <span class="n">myclass</span> <span class="p">{</span>
        <span class="nb">exec</span> <span class="p">{</span> <span class="s2">&quot;/bin/echo $test&quot;</span><span class="p">:</span> <span class="n">logoutput</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">class</span> <span class="n">other</span> <span class="p">{</span>
        <span class="vg">$test</span> <span class="o">=</span> <span class="s1">&#39;other&#39;</span>
        <span class="kp">include</span> <span class="n">myclass</span>
    <span class="p">}</span>

    <span class="kp">include</span> <span class="n">other</span>
</code></pre>
</div>

<p>In this case, there&rsquo;s a top-level scope, a new scope for <code>other</code>,
and the a scope below that for <code>myclass</code>. When this code is
evaluated, <code>$test</code> evaluates to <code>other</code>, not <code>top</code>.</p>

<h4 id="qualified-variables">Qualified Variables</h4>

<p>Puppet supports qualification of variables inside a class. This
allows you to use variables defined in other classes.</p>

<p>For example:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="n">myclass</span> <span class="p">{</span>
        <span class="vg">$test</span> <span class="o">=</span> <span class="s1">&#39;content&#39;</span>
    <span class="p">}</span>

    <span class="k">class</span> <span class="n">anotherclass</span> <span class="p">{</span>
        <span class="vg">$other</span> <span class="o">=</span> <span class="vg">$myclass</span><span class="o">::</span><span class="nb">test</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In this example, the value of the <code>$other</code> variable evaluates to
<code>content</code>. Qualified variables are read-only &mdash; you cannot set a variable&rsquo;s value from other class.</p>

<p>Variable qualification is dependent on the evaluation order of your
classes. Class <code>myclass</code> must be evaluated before class
<code>anotherclass</code> for variables to be set correctly.</p>

<h4 id="facts-as-variables">Facts as Variables</h4>

<p>In addition to user-defined variables, the facts generated by
Facter are also available as variables.  This allows values that you
would see by running <code>facter</code> on a client system within Puppet manifests
and also within Puppet templates.  To use a fact as a variable
prefix the name of the fact with <code>$</code>. For example, the value of the
<code>operatingsystem</code> and <code>puppetversion</code> facts would be available as
the variables <code>$operatingsystem</code> and <code>$puppetversion</code>.</p>

<h4 id="variable-expressions">Variable Expressions</h4>

<p>In Puppet 0.24.6 and later, arbitrary expressions can be assigned
to variables, for example:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$inch_to_cm</span> <span class="o">=</span> <span class="mi">2</span><span class="o">.</span><span class="mi">54</span>
    <span class="vg">$rack_length_cm</span> <span class="o">=</span> <span class="mi">19</span> <span class="o">*</span> <span class="vg">$inch_to_cm</span>
    <span class="vg">$gigabyte</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
    <span class="vg">$can_update</span> <span class="o">=</span> <span class="p">(</span><span class="vg">$ram_gb</span> <span class="o">*</span> <span class="vg">$gigabyte</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span>
</code></pre>
</div>

<p>See the Expression section later on this page for further details
of the expressions that are now available.</p>

<h4 id="the-in-syntax">The &ldquo;in&rdquo; syntax</h4>

<p>From Puppet 2.6.0 you can also use the &ldquo;in&rdquo; syntax.  This operator allows
you to find if the left operand is in the right one. The left operand must
be a string, but the right operand can be:</p>

<ul>
  <li>a string</li>
  <li>an array</li>
  <li>a hash (the search is done on the keys)</li>
</ul>

<p>This syntax can be used in any place where an expression is supported:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$eatme</span> <span class="o">=</span> <span class="s1">&#39;eat&#39;</span>
    <span class="k">if</span> <span class="vg">$eatme</span> <span class="k">in</span> <span class="o">[</span><span class="s1">&#39;ate&#39;</span><span class="p">,</span> <span class="s1">&#39;eat&#39;</span><span class="o">]</span> <span class="p">{</span>
    <span class="o">.</span><span class="n">.</span><span class="o">.</span>
    <span class="p">}</span>

    <span class="vg">$value</span> <span class="o">=</span> <span class="s1">&#39;beat generation&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;eat&#39;</span> <span class="k">in</span> <span class="vg">$value</span> <span class="p">{</span>
      <span class="n">notice</span><span class="p">(</span><span class="s2">&quot;on the road&quot;</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre>
</div>

<h4 id="appending-to-variables">Appending to Variables</h4>

<p>In Puppet 0.24.6 and later, values can be appended to array variables:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$ssh_users</span> <span class="o">=</span> <span class="o">[</span> <span class="s1">&#39;myself&#39;</span><span class="p">,</span> <span class="s1">&#39;someone&#39;</span> <span class="o">]</span>

    <span class="k">class</span> <span class="nb">test</span> <span class="p">{</span>
       <span class="vg">$ssh_users</span> <span class="o">+=</span> <span class="o">[</span><span class="s1">&#39;someone_else&#39;</span><span class="o">]</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Here the <code>$ssh_users</code> variable contains an array with the elements
<code>myself</code> and <code>someone</code>. Using the variable append syntax, <code>+=</code>, we
added another element, <code>someone_else</code> to the array.</p>

<p>Please note, variables cannot be modified in the same scope because of the
declarative nature of Puppet.  As a result, $ssh_users contains the element
&lsquo;someone_else&rsquo; only in the scope of class test and not outside scopes.
Resources outside of this scope will &ldquo;see&rdquo; the original array containing only
myself and someone.</p>

<h3 id="conditionals">Conditionals</h3>

<p>At some point you&rsquo;ll need to use a different value based on the value of a variable, or decide to not do something if a particular value is set.</p>

<p>Puppet currently supports two types of conditionals:</p>

<ul>
  <li>The <em>selector</em> which can be used within resources and variable assignments
to pick the correct value for an attribute, and</li>
  <li><em>statement conditionals</em> which can be used more widely in your
manifests to include additional classes, define distinct sets of
resources within a class, or make other structural decisions.</li>
</ul>

<p>Case statements do not return a value.   Selectors do.  That is the primary difference between them and why you would use one and not the other.</p>

<h4 id="selectors">Selectors</h4>

<p>If you&rsquo;re familiar with programming terms, The selector syntax works like a multi-valued trinary operator, similar to C&rsquo;s <code>foo = bar ? 1 : 0</code> operator where <code>foo</code> will be set to <code>1</code> if <code>bar</code> evaluates to true and <code>0</code> if <code>bar</code> is false.</p>

<p>Selectors are useful to specify a resource attribute or assign a
variable based on a fact or another variable. In addition to any
number of specified values, selectors also allow you to specify a
default if no value matches.  Here&rsquo;s a simple example:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;/etc/config&#39;</span><span class="p">:</span>
        <span class="n">owner</span> <span class="o">=&gt;</span> <span class="vg">$operatingsystem</span> <span class="p">?</span> <span class="p">{</span>
            <span class="s1">&#39;sunos&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;adm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;redhat&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span>
            <span class="n">default</span> <span class="o">=&gt;</span> <span class="k">undef</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>If the <code>$operatingsystem</code> fact (sent up from &lsquo;facter&rsquo;) returns <code>sunos</code> or <code>redhat</code> then the ownership of the file is set to <code>adm</code> or <code>bin</code> respectively. Any other result and the <code>owner</code> attribute will not be set, because it is listed as <code>undef</code>.</p>

<p>Remember to quote the comparators you&rsquo;re using in the selector as
the lack of quotes can cause syntax errors.</p>

<p>Selectors can also be used in variable assignment:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$owner</span> <span class="o">=</span> <span class="vg">$operatingsystem</span> <span class="p">?</span> <span class="p">{</span>
        <span class="n">sunos</span>   <span class="o">=&gt;</span> <span class="s1">&#39;adm&#39;</span><span class="p">,</span>
        <span class="n">redhat</span>  <span class="o">=&gt;</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=&gt;</span> <span class="k">undef</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In Puppet 0.25.0 and later, selectors can also be used with regular
expressions:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$owner</span> <span class="o">=</span> <span class="vg">$operatingsystem</span> <span class="p">?</span> <span class="p">{</span><span class="sr" />
<span class="sr">        /(redhat|debian)/</span>   <span class="o">=&gt;</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=&gt;</span> <span class="k">undef</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In this last example, if <code>$operatingsystem</code> value matches either redhat
or debian, then <code>bin</code> will be the selected result, otherwise the owner
will not be set (<code>undef</code>).</p>

<p>Like Perl and some other languages with regular expression support, captures in selector regular expressions automatically create some
limited scope variables (<code>$0</code> to <code>$n</code>):</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$system</span> <span class="o">=</span> <span class="vg">$operatingsystem</span> <span class="p">?</span> <span class="p">{</span><span class="sr" />
<span class="sr">        /(redhat|debian)/</span>   <span class="o">=&gt;</span> <span class="s2">&quot;our system is $1&quot;</span><span class="p">,</span>
        <span class="n">default</span> <span class="o">=&gt;</span> <span class="s2">&quot;our system is unknown&quot;</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In this last example, <code>$1</code> will get replaced by the content of the
capture (here either <code>redhat</code> or <code>debian</code>).</p>

<p>The variable <code>$0</code> will contain the whole match.</p>

<h4 id="case-statement">Case Statement</h4>

<p><code>Case</code> is the other form of Puppet&rsquo;s two conditional statements, which
can be wrapped around any Puppet code to add decision-making logic
to your manifests.  Case statements, unlike selectors, do not return a value.   A common use for the <code>case</code> statement is to apply different classes to a particular node based on its operating
system:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">case</span> <span class="vg">$operatingsystem</span> <span class="p">{</span>
        <span class="n">sunos</span><span class="p">:</span>   <span class="p">{</span> <span class="kp">include</span> <span class="n">solaris</span> <span class="p">}</span> <span class="c1"># apply the solaris class</span>
        <span class="n">redhat</span><span class="p">:</span>  <span class="p">{</span> <span class="kp">include</span> <span class="n">redhat</span>  <span class="p">}</span> <span class="c1"># apply the redhat class</span>
        <span class="n">default</span><span class="p">:</span> <span class="p">{</span> <span class="kp">include</span> <span class="n">generic</span> <span class="p">}</span> <span class="c1"># apply the generic class</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Case statements can also specify multiple match conditions by separating
each with a comma:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">case</span> <span class="vg">$hostname</span> <span class="p">{</span>
        <span class="n">jack</span><span class="p">,</span><span class="n">jill</span><span class="p">:</span>      <span class="p">{</span> <span class="kp">include</span> <span class="n">hill</span>    <span class="p">}</span> <span class="c1"># apply the hill class</span>
        <span class="n">humpty</span><span class="p">,</span><span class="n">dumpty</span><span class="p">:</span>  <span class="p">{</span> <span class="kp">include</span> <span class="n">wall</span>    <span class="p">}</span> <span class="c1"># apply the wall class</span>
        <span class="n">default</span><span class="p">:</span>        <span class="p">{</span> <span class="kp">include</span> <span class="n">generic</span> <span class="p">}</span> <span class="c1"># apply the generic class</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Here, if the <code>$hostname</code> fact returns either <code>jack</code> or <code>jill</code> the
<code>hill</code> class would be included.</p>

<p>In Puppet 0.25.0 and later, the <code>case</code> statement also supports
regular expressions:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">case</span> <span class="vg">$hostname</span> <span class="p">{</span><span class="sr" />
<span class="sr">        /^j(ack|ill)$/</span><span class="p">:</span>   <span class="p">{</span> <span class="kp">include</span> <span class="n">hill</span>    <span class="p">}</span> <span class="c1"># apply the hill class</span><span class="sr" />
<span class="sr">        /^[hd]umpty$/</span><span class="p">:</span>    <span class="p">{</span> <span class="kp">include</span> <span class="n">wall</span>    <span class="p">}</span> <span class="c1"># apply the wall class</span>
        <span class="n">default</span><span class="p">:</span>          <span class="p">{</span> <span class="kp">include</span> <span class="n">generic</span> <span class="p">}</span> <span class="c1"># apply the generic class</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In this last example, if <code>$hostname</code> matches either <code>jack</code> or
<code>jill</code>, then the <code>hill</code> class will be included. But if <code>$hostname</code>
matches either <code>humpty</code> or <code>dumpty</code>, then the <code>wall</code> class will be
included.</p>

<p>As with selectors (see above), regular expressions captures are also available.
These create limited scope variables <code>$0</code> to <code>$n</code>:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">case</span> <span class="vg">$hostname</span> <span class="p">{</span><span class="sr" />
<span class="sr">        /^j(ack|ill)$/</span><span class="p">:</span>   <span class="p">{</span> <span class="n">notice</span><span class="p">(</span><span class="s2">&quot;Welcome $1!&quot;</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">default</span><span class="p">:</span>          <span class="p">{</span> <span class="n">notice</span><span class="p">(</span><span class="s2">&quot;Welcome stranger&quot;</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In this last example, if <code>$host</code> is <code>jack</code> or <code>jill</code> then a notice
message will be logged with <code>$1</code> replaced by either <code>ack</code> or
<code>ill</code>.  <code>$0</code> contains the whole match.</p>

<h4 id="ifelse-statement">If/Else Statement</h4>

<p>The <code>if/else</code> provides branching options based on the truth value of a variable:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">if</span> <span class="vg">$variable</span> <span class="p">{</span>
        <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;/some/file&#39;</span><span class="p">:</span> <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">present</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;/some/other/file&#39;</span><span class="p">:</span> <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">present</span> <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In Puppet 0.24.6 and later, the <code>if</code> statement can also branch
based on the value of an expression:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">if</span> <span class="vg">$server</span> <span class="o">==</span> <span class="s1">&#39;mongrel&#39;</span> <span class="p">{</span>
        <span class="kp">include</span> <span class="n">mongrel</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kp">include</span> <span class="n">nginx</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In the above example, if the value of the variable <code>$server</code> is equal to <code>mongrel</code>, Puppet
will include the class <code>mongrel</code>, otherwise it will include the class <code>nginx</code>.</p>

<p>From version 2.6.0 and later an <code>elsif</code> construct was introduced into the language:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">if</span> <span class="vg">$server</span> <span class="o">==</span> <span class="s1">&#39;mongrel&#39;</span> <span class="p">{</span>
        <span class="kp">include</span> <span class="n">mongrel</span>
    <span class="p">}</span> <span class="k">elsif</span> <span class="vg">$server</span> <span class="o">==</span> <span class="s1">&#39;nginx&#39;</span> <span class="p">{</span>
        <span class="kp">include</span> <span class="n">nginx</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kp">include</span> <span class="n">thin</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Arithmetic expressions are also possible, for example:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">if</span> <span class="vg">$ram</span> <span class="o">&gt;</span> <span class="mi">1024</span> <span class="p">{</span>
        <span class="vg">$maxclient</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In the previous example if the value of the variable <code>$ram</code> is
greater than <code>1024</code>,  Puppet will set the value of the <code>$maxclient</code> variable
to <code>500</code>.</p>

<p>More complex expressions combining arithmetric expressions with the
Boolean operators <code>and</code>, <code>or</code>, or <code>not</code> are also possible:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">if</span> <span class="p">(</span> <span class="vg">$processor_count</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">((</span> <span class="vg">$ram</span> <span class="o">&gt;=</span> <span class="mi">16</span> <span class="o">*</span> <span class="vg">$gigabyte</span> <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span> <span class="vg">$disksize</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="p">))</span> <span class="p">{</span>
        <span class="kp">include</span> <span class="n">for_big_irons</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kp">include</span> <span class="n">for_small_box</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>See the Expression section further down for more information on expressions.</p>

<h3 id="virtual-resources">Virtual Resources</h3>

<p>See <a href="./virtual_resources.html">Virtual Resources</a>.</p>

<p>Virtual resources are available in Puppet 0.20.0 and later.</p>

<p>Virtual resources are resources that are not sent to the client unless <code>realized</code>.</p>

<p>The syntax for a virtual resource is:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vi">@user</span> <span class="p">{</span> <span class="n">luke</span><span class="p">:</span> <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="n">present</span> <span class="p">}</span>
</code></pre>
</div>

<p>The user luke is now defined virtually. To realize that definition,
you can use a <code>collection</code>:</p>

<div class="highlight"><pre><code class="ruby">    <span class="no">User</span> <span class="o">&lt;|</span> <span class="n">title</span> <span class="o">==</span> <span class="n">luke</span> <span class="o">|&gt;</span>
</code></pre>
</div>

<p>This can be read as &lsquo;the user whose title is luke&rsquo;.   This is equivalent to using
the <code>realize</code> function:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">realize</span> <span class="no">User</span><span class="o">[</span><span class="n">luke</span><span class="o">]</span>
</code></pre>
</div>

<p>Realization could also use other criteria, such as realizing Users that match
a certain group, or using a metaparameter like &lsquo;tag&rsquo;.</p>

<p>The motivation for this feature is somewhat complicated; please see
the <a href="./virtual_resources.html">Virtual Resources</a> page for more information.</p>

<h3 id="exported-resources">Exported Resources</h3>

<p>Exported resources are an extension of virtual resources used to
allow different hosts managed by Puppet to influence each other&rsquo;s
Puppet configuration.  This is described in detail on the <a href="./exported_resources.html">Exported Resources</a> page.<br />
As with virtual resources, new syntax was added to the language for this purpose.</p>

<p>The key syntactical difference between virtual and exported
resources is that the special sigils (@ and &lt;| |&gt;) are doubled (@@
and &laquo;| |&gt;&gt;) when referring to an exported resource.</p>

<p>Here is an example with exported resources that shares SSH keys
between clients:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="n">ssh</span> <span class="p">{</span>
    <span class="vc">@@sshkey</span> <span class="p">{</span> <span class="vg">$hostname</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=&gt;</span> <span class="n">dsa</span><span class="p">,</span> <span class="n">key</span> <span class="o">=&gt;</span> <span class="vg">$sshdsakey</span> <span class="p">}</span>
        <span class="no">Sshkey</span> <span class="o">&lt;&lt;|</span> <span class="o">|&gt;&gt;</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In the above example, notice that fulfillment and exporting are used
together, so that any node that gets the &lsquo;sshkey&rsquo; class will have
all the ssh keys of other hosts.  This could be done differently so
that the keys could be realized on different hosts.</p>

<p>To actually work, the <code>storeconfig</code> parameter must be set to
<code>true</code> in puppet.conf.  This allows configurations from client
to be stored on the central server.</p>

<p>The details of this feature are somewhat complicated; see
the <a href="./exported_resources.html">Exported Resources</a>
page for more information.</p>

<h3 id="reserved-words--acceptable-characters">Reserved Words &amp; Acceptable Characters</h3>

<p>Variable names can include alphanumeric characters and underscores, and are case-sensitive.</p>

<p>Class names, module names, and the names of defined and custom resource types should be restricted to lowercase alphanumeric characters and underscores, and should begin with a lowercase letter; that is, they should match the expression <code>[a-z][a-z0-9_]*</code>. Although some names that violate these restrictions currently work, using them is not recommended.</p>

<p>Class and defined resource type names can use <code>::</code> as a namespace separator, which is both semantically useful and a means of directing the behavior of the module autoloader. The final segment of a <a href="#qualified-variables">qualified variable</a> name must obey the restrictions on variable names, and the preceding segments must obey the restrictions on class names. </p>

<p>Parameters used in parameterized classes and defined resource types can include alphanumeric characters and underscores, cannot begin with an underscore, and are case-sensitive. In practice, they should be treated as though they were under the same restrictions as class names in order to maximize future compatibility.</p>

<p>There is no practical restriction on resource names. </p>

<p>Any word that the syntax uses for special meaning is
a reserved word, meaning you cannot use it for
variable or type names.   Words like <code>true</code>, <code>define</code>,
<code>inherits</code>, and <code>class</code> are all reserved. If you ever need to use a
reserved word as a value, be sure to quote it.</p>

<h3 id="comments">Comments</h3>

<p>Puppet supports two types of comments:</p>

<ul>
  <li>Unix shell style comments; they can either be on their own line or at
the end of a line.</li>
  <li>multi-line C-style comments (available in Puppet 0.24.7 and later)</li>
</ul>

<p>Here is a shell style comment:</p>

<div class="highlight"><pre><code class="ruby">    <span class="c1"># this is a comment</span>
</code></pre>
</div>

<p>You can see an example of a multi-line comment:</p>

<div class="highlight"><pre><code class="ruby">    <span class="sr">/*</span>
<span class="sr">    this is a comment</span>
<span class="sr">    */</span>
</code></pre>
</div>

<h2 id="expressions">Expressions</h2>

<p>Starting with version 0.24.6 the Puppet language supports arbitrary
expressions in <code>if</code> statement boolean tests and in the right hand
value of variable assignments.</p>

<p>Puppet expressions can be composed of:</p>

<ul>
  <li>boolean expressions, which are combination of other expressions
combined by boolean operators (<code>and</code>, <code>or</code> and <code>not</code>)</li>
  <li>comparison expressions, which consist of variables, numerical
operands or other expressions combined with comparison operators (
<code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>)</li>
  <li>arithmetic expressions, which consists of variables, numerical
operands or other expressions combined with the following
arithmetic operators: <code>+</code>, <code>-</code>, <code>/</code>, <code>*</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code></li>
  <li>and in Puppet 0.25.0 and later, regular expression matches with the help of the
regex match operator: <code>=~</code> and <code>!~</code></li>
</ul>

<p>Expressions can be enclosed in parenthesis, <code>()</code>, to group
expressions and resolve operator ambiguity.</p>

<h3 id="operator-precedence">Operator precedence</h3>

<p>The Puppet operator precedence conforms to the standard precedence in
most systems, from highest to lowest:</p>

<pre><code>! -&gt; not
* / -&gt; times and divide
- + -&gt; minus, plus
&lt;&lt; &gt;&gt; -&gt; left shift and right shift
== != -&gt; not equal, equal
&gt;= &lt;= &gt; &lt; -&gt; greater equal, less or equal, greater than, less than
and
or
</code></pre>

<h3 id="expression-examples">Expression examples</h3>

<h4 id="comparison-expressions">Comparison expressions</h4>

<p>Comparison expressions include tests for equality using the <code>==</code>
expression:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">if</span> <span class="vg">$variable</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span> <span class="p">{</span>
        <span class="kp">include</span> <span class="n">bar</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kp">include</span> <span class="n">foobar</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Here if <code>$variable</code> has a value of <code>foo</code>, Puppet will then include the <code>bar</code>
class, otherwise it will include the <code>foobar</code> class.</p>

<p>Here is another example shows the use of the <code>!=</code> (&lsquo;not equal&rsquo;) comparison
operator:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">if</span> <span class="vg">$variable</span> <span class="o">!=</span> <span class="s1">&#39;foo&#39;</span> <span class="p">{</span>
        <span class="vg">$othervariable</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="vg">$othervariable</span> <span class="o">=</span> <span class="s1">&#39;foobar&#39;</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In our second example if <code>$variable</code> is not equal to a value of <code>foo</code>, Puppet will then set
the value of the <code>$othervariable</code> variable to <code>bar</code>, otherwise it will set the
<code>$othervariable</code> variable to <code>foobar</code>.</p>

<h4 id="arithmetic-expressions">Arithmetic expressions</h4>

<p>You can also perform a variety of arithmetic expressions, for
example:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$one</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="vg">$one_thirty</span> <span class="o">=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">30</span>
    <span class="vg">$two</span> <span class="o">=</span> <span class="mi">2</span><span class="o">.</span><span class="mo">034</span><span class="n">e</span><span class="o">-</span><span class="mi">2</span>

    <span class="vg">$result</span> <span class="o">=</span> <span class="p">(((</span> <span class="vg">$two</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="vg">$one_thirty</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">5</span><span class="o">.</span><span class="mi">45</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">6</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="vg">$two</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mh">0x800</span> <span class="o">+</span> <span class="o">-</span><span class="mi">9</span><span class="p">)</span>
</code></pre>
</div>

<h4 id="boolean-expressions">Boolean expressions</h4>

<p>Boolean expressions are also possible using <code>or</code>, <code>and</code> and <code>not</code>:</p>

<div class="highlight"><pre><code class="ruby">    <span class="vg">$one</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="vg">$two</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="vg">$var</span> <span class="o">=</span> <span class="p">(</span> <span class="vg">$one</span> <span class="o">&lt;</span> <span class="vg">$two</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span> <span class="vg">$one</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="vg">$two</span> <span class="p">)</span>
</code></pre>
</div>

<h4 id="regular-expressions">Regular expressions</h4>

<p>In Puppet 0.25.0 and later, Puppet supports regular expression matching
using <code>=~</code> (match) and <code>!~</code> (not-match) for example:</p>

<div class="highlight"><pre><code class="ruby">    <span class="k">if</span> <span class="vg">$host</span> <span class="o">=~</span> <span class="sr">/^www(\d+)\./</span> <span class="p">{</span>
        <span class="n">notice</span><span class="p">(</span><span class="s1">&#39;Welcome web server #$1&#39;</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>Like case and selectors, the regex match operators create limited
scope variables for each regex capture.  In the previous example,
<code>$1</code> will be replaced by the number following <code>www</code> in <code>$host</code>.
Those variables are valid only for the statements inside the
braces of the if clause.</p>

<h3 id="backus-naur-form">Backus Naur Form</h3>

<p>We&rsquo;ve already covered the list of operators, though if you wish to see it,
here&rsquo;s the available operators in Backus Naur Form:</p>

<pre><code>&lt;exp&gt; ::=  &lt;exp&gt; &lt;arithop&gt; &lt;exp&gt;
         | &lt;exp&gt; &lt;boolop&gt; &lt;exp&gt;
         | &lt;exp&gt; &lt;compop&gt; &lt;exp&gt;
         | &lt;exp&gt; &lt;matchop&gt; &lt;regex&gt;
         | ! &lt;exp&gt;
         | - &lt;exp&gt;
         | "(" &lt;exp&gt; ")"
         | &lt;rightvalue&gt;

&lt;arithop&gt; ::= "+" | "-" | "/" | "*" | "&lt;&lt;" | "&gt;&gt;"
&lt;boolop&gt;  ::= "and" | "or"
&lt;compop&gt;  ::= "==" | "!=" | "&gt;" | "&gt;=" | "&lt;=" | "&lt;"
&lt;matchop&gt;  ::= "=~" | "!~"

&lt;rightvalue&gt; ::= &lt;variable&gt; | &lt;function-call&gt; | &lt;literals&gt;
&lt;literals&gt; ::= &lt;float&gt; | &lt;integer&gt; | &lt;hex-integer&gt; | &lt;octal-integer&gt; | &lt;quoted-string&gt;
&lt;regex&gt; ::= '/regex/'
</code></pre>

<h2 id="functions">Functions</h2>

<p>Puppet supports many built in functions; see the <a href="/references/stable/function.html">Function Reference</a> for details &mdash; see <a href="/guides/custom_functions.html">Custom Functions</a> for information on how to create
your own custom functions.</p>

<p>Some functions can be used as a statement:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">notice</span><span class="p">(</span><span class="s1">&#39;Something weird is going on&#39;</span><span class="p">)</span>
</code></pre>
</div>

<p>(The notice function above is an example of a function that will log on the server)</p>

<p>Or without parentheses:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">notice</span> <span class="s1">&#39;Something weird is going on&#39;</span>
</code></pre>
</div>

<p>Some functions instead return a value:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">file</span> <span class="p">{</span> <span class="s1">&#39;/my/file&#39;</span><span class="p">:</span> <span class="n">content</span> <span class="o">=&gt;</span> <span class="n">template</span><span class="p">(</span><span class="s1">&#39;mytemplate.erb&#39;</span><span class="p">)</span> <span class="p">}</span>
</code></pre>
</div>

<p>All functions run on the Puppet master, so you only have access to the file system and resources on that host from your functions. The only exception to this is that the value of any Facter facts that have been sent to the master from your clients are also at your disposal.  See the <a href="./tools.html">Tools Guide</a> for more information about these components.</p>

<h2 id="importing-manifests">Importing Manifests</h2>

<p>Puppet has an <code>import</code> keyword for importing other manifests. Code
in those external manifests should always be stored in a class or
defined resource type, or else it will be imported into the main scope and applied
to all nodes. Currently files are only searched for within the same
directory as the file doing the importing.</p>

<p>Files can also be imported using globbing, as implemented by Ruby&rsquo;s
<code>Dir.glob</code> method:</p>

<div class="highlight"><pre><code class="ruby">    <span class="n">import</span> <span class="s1">&#39;classes/*.pp&#39;</span>
    <span class="n">import</span> <span class="s1">&#39;packages/[a-z]*.pp&#39;</span>
</code></pre>
</div>

<p>Best practices calls for organizing manifests into <a href="./modules.html">Modules</a></p>

<h2 id="handling-compilation-errors">Handling Compilation Errors</h2>

<p>Puppet does not use manifests directly, it compiles them down to a internal format
that the clients can understand.</p>

<p>By default, when a manifest fails to compile, the previously compiled version of the Puppet
manifest is used instead.</p>

<p>This behavior is governed by a setting in <code>puppet.conf</code> called <code>usecacheonfailure</code>
and is set by default to <code>true</code>.</p>

<p>This may result in surprising behaviour if you are editing
complex configurations.</p>

<p>Running the Puppet client with <code>--no-usecacheonfailure</code> or with <code>--test</code>, or setting
<code>usecacheonfailure = false</code> in the configuration file, will disable
this behaviour.</p>

            </div>
            <div class="secondary-content">
                  <div id="subCol">
                  <h3 class="chapter">Contents</h3>
                  <ol class="chapters">
                  <ol class="toc"><li><a href="#ready-to-dive-in">Ready To Dive In?</a></li><li><a href="#language-feature-by-release">Language Feature by Release</a></li><li><a href="#resources">Resources</a></li><li><a href="#metaparameters">Metaparameters</a></li><li><a href="#resource-defaults">Resource Defaults</a></li><li><a href="#resource-collections">Resource Collections</a></li><li><a href="#chaining-resources">Chaining resources</a></li><li><a href="#nodes">Nodes</a></li><li><a href="#additional-language-features">Additional Language Features</a></li><li><a href="#quoting">Quoting</a></li><li><a href="#variable-interpolation-with-quotes">Variable Interpolation With Quotes</a></li><li><a href="#capitalization">Capitalization</a></li><li><a href="#arrays">Arrays</a></li><li><a href="#hashes">Hashes</a></li><li><a href="#variables">Variables</a></li><li><a href="#conditionals">Conditionals</a></li><li><a href="#virtual-resources">Virtual Resources</a></li><li><a href="#exported-resources">Exported Resources</a></li><li><a href="#reserved-words--acceptable-characters">Reserved Words &amp; Acceptable Characters</a></li><li><a href="#comments">Comments</a></li><li><a href="#expressions">Expressions</a></li><li><a href="#operator-precedence">Operator precedence</a></li><li><a href="#expression-examples">Expression examples</a></li><li><a href="#backus-naur-form">Backus Naur Form</a></li><li><a href="#functions">Functions</a></li><li><a href="#importing-manifests">Importing Manifests</a></li><li><a href="#handling-compilation-errors">Handling Compilation Errors</a></li></ol>
                  </ol>
                  </div>
            </div>
          </div>
        </div>
      </section>

		<footer id="footer">
      <div class="site-width">

        <div class="primary-secondary-content">
          <div class="primary-content">
            <section id="newsletter">
                 <h4>Puppet Labs is Hiring</h4>
                 <p><a href="http://www.puppetlabs.com/company/jobs/">Engineers, developers & consultants</a>
                  <p>  
		<h4>Newsletter</h4>

              <p>Stay up to date on all things puppet</p>
              
				<form class="lpeRegForm formNotEmpty" method="post" enctype="application/x-www-form-urlencoded" action="http://info.puppetlabs.com/index.php/leadCapture/save"; id="mktForm_1013" name="mktForm_1013">
				
				<label>Email Address:</label><span class='mktInput'><input class='mktFormText mktFormEmail' name="Email" id="Email" type='text' value="" maxlength='255'  /><span class='mktFormMsg'></span></span>
				
				<input id='mktFrmSubmit' type='submit' class='btn' style="width: auto; overflow: visible; padding-left: .25em; padding-right: .25em;" value='Subscribe' name='submitButton' onclick='formSubmit(document.getElementById("mktForm_1013")); return false;' />
				
				<input style='display: none;' id='mktFrmReset' type='reset' value='Clear' name='resetButton' onclick='formReset(document.getElementById("mktForm_1013")); return false;' />
	
				<span style="display:none;"><input type="text" name="_marketo_comments" value="" /></span>
				<input type="hidden" name="lpId" value="-1" />
				<input type="hidden" name="subId" value="100" />

				<input type="hidden" name="kw" value="" />
				<input type="hidden" name="cr" value="" />
				
				<input type="hidden" name="searchstr" value="" />
				<input type="hidden" name="lpurl" value="http://info.puppetlabs.com/testsubscription.html?cr={creative}&kw={keyword}"; />
				<input type="hidden" name="formid" value="1013" />
				<input type="hidden" name="returnURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="retURL" value="http://www.puppetlabs.com/misc/subscription-thank-you/"; />
				<input type="hidden" name="_mkt_disp" value="return" />
				<input type="hidden" name="_mkt_trk" value="" />

				</form>
				<script type="text/javascript" src="http://info.puppetlabs.com/js/mktFormSupport.js"></script>
				
				<script type="text/javascript">
				function formSubmit(elt) {
				return Mkto.formSubmit(elt);
				}
				function formReset(elt) {
				return Mkto.formReset(elt);
				}
				</script>
              

            </section>
            <section id="elsewhere">
              <h4>Get Involved</h4>
              <ul>

                <li class="chat"><a href="http://webchat.freenode.net/?channels=puppet" rel="external"><span class="indicator"></span><span>Chat with us on IRC</span></a></li>
		<li class="discussion"><a href="http://groups.google.com/group/puppet-dev" rel="external"><span class="indicator"></span><span>Join the Puppet Developer List</span></a></li>
                <li class="discussion"><a href="http://groups.google.com/group/puppet-users?pli=1" rel="external"><span class="indicator"></span><span>Join the Puppet User List</span></a></li>
                
                <li class="linkedin"><a href="http://www.linkedin.com/groups?about=&gid=696467&trk=anet_ug_grppro" rel="external"><span class="indicator"></span><span>Join the Puppet Users LinkedIn group</span></a></li>	

              </ul>
		<p>
		              		<h4>Follow us&#8230;</h4>

              		<ul class="followus"><li id='myprofiles_1'><a href='/feed/atom/' title='RSS'><img border='0' width='22' height='22' src='http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/rss.png' alt='RSS'/></a></li> <li id='myprofiles_2'><a href='http://www.facebook.com/pages/Puppet-Labs/219089920711' title='FaceBook'><img border='0' width='22' height='22' src='http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/facebook.png' alt='FaceBook'/></a></li> <li id='myprofiles_3'><a href='http://www.twitter.com/puppetlabs' title='Twitter'><img border='0' width='22' height='22' src='http://www.puppetlabs.com/wp-content/plugins/my-profiles/images/twitter.png' alt='Twitter'/></a></li> </ul>
              	</p>

            </section>
          </div>
          <div class="secondary-content">
            <section id="book-it">
              <h4>Get the book!</h4>

              <p>Written by James Turnbull, <a href="http://apress.com/book/view/1590599780" rel="nofollow">Pulling Strings with Puppet</a> is the first book to introduce the powerful Puppet system administration tool. </p>
              <a href="http://apress.com/book/view/1590599780" rel="nofollow"><img src="http://www.puppetlabs.com/images/book.png" /></a>
            </section>
          </div>
        </div>
      </div>
		</footer>

    <div id="copyright">
      <div class="site-width">
        &copy; 2010 <a href="http://www.puppetlabs.com/" title="Puppet Labs">Puppet Labs</a>
        <span class="vcard">
         <span class="org"></span>
         <a class="email" href="mailto:info@puppetlabs.com">info@puppetlabs.com</a>

          <span class="adr">
           <span class="street-address">411 NW Park Street</span>
           /
           <span class="locality">Portland</span>, 
           <span class="region">OR</span>
           <span class="postal-code">97209</span>

          </span>

         <span class="tel">1-877-575-9775</span>
        </span>          
      </div>
    </div>
    <script src="http://munchkin.marketo.net/munchkin.js" type="text/javascript"></script> <script>mktoMunchkin("307-QLA-991");</script> 
    
  	<script type="text/javascript">Cufon.now();</script>
  	<style type="text/css">h1, h2, .btn { visibility : visible; }</style>

	</body>
</html>        
